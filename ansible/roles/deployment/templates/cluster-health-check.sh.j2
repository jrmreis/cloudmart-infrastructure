#!/bin/bash
export AWS_REGION={{ aws_region }}
echo "Checking EKS cluster status for {{ cluster_name }} in {{ aws_region }}..."
eksctl get cluster --name {{ cluster_name }} --region {{ aws_region }}

ENDPOINT=$(aws eks describe-cluster --name {{ cluster_name }} --region {{ aws_region }} --query "cluster.endpoint" --output text)
echo "Cluster endpoint: $ENDPOINT"

STATUS=$(aws eks describe-cluster --name {{ cluster_name }} --region {{ aws_region }} --query "cluster.status" --output text)
echo "Cluster status: $STATUS"

if [ "$STATUS" == "ACTIVE" ]; then
  echo "Cluster is active and ready."
  aws eks update-kubeconfig --name {{ cluster_name }} --region {{ aws_region }}
  kubectl get nodes
else
  echo "Cluster is not active yet. Current status: $STATUS"
fi
