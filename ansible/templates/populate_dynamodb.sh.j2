#!/bin/bash
# Set AWS region - change this to your region if different
AWS_REGION="us-east-1"

echo "Creating cloudmart-products table if it doesn't exist..."
# Create Products table if it doesn't exist - using on-demand billing (PAY_PER_REQUEST)
aws dynamodb create-table \
    --table-name cloudmart-products \
    --attribute-definitions AttributeName=id,AttributeType=S \
    --key-schema AttributeName=id,KeyType=HASH \
    --billing-mode PAY_PER_REQUEST \
    --region $AWS_REGION \
    2>/dev/null || echo "Table already exists, continuing with population..."

echo "Waiting for table to be active..."
# Wait for table creation
aws dynamodb wait table-exists --table-name cloudmart-products --region $AWS_REGION

echo "Populating products table..."
# Add Camisa Polo
aws dynamodb put-item \
    --table-name cloudmart-products \
    --item '{
        "id": {"S": "4c7c9f5e"},
        "name": {"S": "Camisa Polo"},
        "description": {"S": "Camisa Polo Preta Tam G"},
        "price": {"N": "129.9"},
        "image": {"S": "https://down-br.img.susercontent.com/file/3961e7b610a713f24d8231bb185173a4"},
        "createdAt": {"S": "2025-04-11T20:18:49.658Z"}
    }' \
    --region $AWS_REGION

# Add Fruki Guarana
aws dynamodb put-item \
    --table-name cloudmart-products \
    --item '{
        "id": {"S": "p1"},
        "name": {"S": "Fruki Guarana"},
        "description": {"S": "Refrigerante Guarana 2L"},
        "price": {"N": "5.00"},
        "image": {"S": "https://down-br.img.susercontent.com/file/fruki.jpg"},
        "createdAt": {"S": "2025-04-11T20:19:49.658Z"}
    }' \
    --region $AWS_REGION

# Add Coca Cola
aws dynamodb put-item \
    --table-name cloudmart-products \
    --item '{
        "id": {"S": "p2"},
        "name": {"S": "Coca Cola"},
        "description": {"S": "Refrigerante Cola 2L"},
        "price": {"N": "5.00"},
        "image": {"S": "https://down-br.img.susercontent.com/file/coca-cola.jpg"},
        "createdAt": {"S": "2025-04-11T20:20:49.658Z"}
    }' \
    --region $AWS_REGION

# Add Pão Francês
aws dynamodb put-item \
    --table-name cloudmart-products \
    --item '{
        "id": {"S": "p3"},
        "name": {"S": "Pão Francês"},
        "description": {"S": "Pão Francês Fresquinho"},
        "price": {"N": "1.99"},
        "image": {"S": "https://down-br.img.susercontent.com/file/pao-frances.jpg"},
        "createdAt": {"S": "2025-04-11T20:21:49.658Z"}
    }' \
    --region $AWS_REGION

echo "Verifying data insertion..."
aws dynamodb scan --table-name cloudmart-products --region $AWS_REGION --query "Items[*]" --output json

echo "DynamoDB products table has been created and populated successfully!"
